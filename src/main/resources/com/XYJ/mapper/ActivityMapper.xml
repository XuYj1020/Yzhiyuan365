<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.XYJ.mapper.ActivityMapper">

    <insert id="insert">
        insert into activity(
            activityid,
            organizationid,
            title,
            introduction,
            starttime,
            endtime,
            province,
            city,
            district,
            place,
            numberofrequiredvolunteer,
            numberofenrolledvolunteer,
            activestatusid,
            creationtime,
            enrolmentopeningtime,
            enrolmentdeadline,
            volunteerhours,
            pictureaddress,
            admissionpolicy,
            creditscorerequirement,
            leaveapproval,
            acstyle,
            havealeader
        )values(
                #{activityid},
                #{organizationid},
                #{title},
                #{introduction},
                #{starttime},
                #{endtime},
                #{province},
                #{city},
                #{district},
                #{place},
                #{numberofrequiredvolunteer},
                #{numberofenrolledvolunteer},
                6,
                now(),
                #{enrolmentopeningtime},
                #{enrolmentdeadline},
                #{volunteerhours},
                #{pictureaddress},
                #{admissionpolicy},
                #{creditscorerequirement},
                #{leaveapproval},
                #{acstyle},
                #{havealeader}
                       );
    </insert>
    <select id="selectByAcstyleid" resultType="com.XYJ.pojo.Activity">
        select * from activity where acstyle=#{acstyle} and activestatusid in (1,2,3) ORDER BY RAND() LIMIT 12;
    </select>



    <select id="selectByAcstyleidAll" resultType="com.XYJ.pojo.Activity">
        select * from activity where activestatusid in (1,2,3) ORDER BY RAND() LIMIT 12;
    </select>


<!--    <resultMap id="rs2" type="com.XYJ.pojo.Activity">-->
<!--        &lt;!&ndash;        先描述自己的信息&ndash;&gt;-->
<!--        <id column="activityid" property="activityid"></id>-->
<!--        <result column="organizationid" property="organizationid" ></result>-->
<!--        <result column="title" property="title" ></result>-->
<!--        <result column="introduction" property="introduction" ></result>-->
<!--        <result column="starttime" property="starttime" ></result>-->
<!--        <result column="endtime" property="endtime" ></result>-->
<!--        <result column="province" property="province" ></result>-->
<!--        <result column="city" property="city" ></result>-->
<!--        <result column="district" property="district" ></result>-->
<!--        <result column="place" property="place" ></result>-->
<!--        <result column="numberofrequiredvolunteer" property="numberofrequiredvolunteer" ></result>-->
<!--        <result column="numberofenrolledvolunteer" property="numberofenrolledvolunteer" ></result>-->
<!--        <result column="activestatusid" property="activestatusid" ></result>-->
<!--        <result column="creationtime" property="creationtime" ></result>-->
<!--        <result column="enrolmentopeningtime" property="enrolmentopeningtime" ></result>-->
<!--        <result column="enrolmentdeadline" property="enrolmentdeadline" ></result>-->
<!--        <result column="volunteerhours" property="volunteerhours" ></result>-->
<!--        <result column="pictureaddress" property="pictureaddress" ></result>-->
<!--        <result column="admissionpolicy" property="admissionpolicy" ></result>-->
<!--        <result column="creditscorerequirement" property="creditscorerequirement" ></result>-->
<!--        <result column="leaveapproval" property="leaveapproval" ></result>-->
<!--        <result column="aacstyle" property="acstyle" ></result>-->
<!--    </resultMap>-->

<!--    <select id="selectByAcstyleidjoin" resultType="com.XYJ.pojo.Activity">-->
<!--        select acstyle.acstyle as aacstyle from activity , acstyle where activity.acstyle = acstyle.acstyleid and activity.activityid = #{activityid}-->
<!--    </select>-->


        <resultMap id="rs1" type="com.XYJ.pojo.Activity">
<!--        先描述自己的信息-->
        <id column="activityid" property="activityid"></id>
        <result column="organizationid" property="organizationid" ></result>
        <result column="title" property="title" ></result>
        <result column="introduction" property="introduction" ></result>
        <result column="starttime" property="starttime" ></result>
        <result column="endtime" property="endtime" ></result>
        <result column="province" property="province" ></result>
        <result column="city" property="city" ></result>
        <result column="district" property="district" ></result>
        <result column="place" property="place" ></result>
        <result column="numberofrequiredvolunteer" property="numberofrequiredvolunteer" ></result>
        <result column="numberofenrolledvolunteer" property="numberofenrolledvolunteer" ></result>
        <result column="activestatusid" property="activestatusid" ></result>
        <result column="creationtime" property="creationtime" ></result>
        <result column="enrolmentopeningtime" property="enrolmentopeningtime" ></result>
        <result column="enrolmentdeadline" property="enrolmentdeadline" ></result>
        <result column="volunteerhours" property="volunteerhours" ></result>
        <result column="pictureaddress" property="pictureaddress" ></result>
        <result column="admissionpolicy" property="admissionpolicy" ></result>
        <result column="creditscorerequirement" property="creditscorerequirement" ></result>
        <result column="leaveapproval" property="leaveapproval" ></result>
        <result column="acstyle" property="acstyle" ></result>
        <result column="havealeader" property="havealeader" ></result>
        <association property="acstyles" javaType="com.XYJ.pojo.Acstyle">
            <id column="acstyleid" property="acstyleid"></id>
            <result column="aa" property="acstyle"></result>
        </association>
        <association property="areanews" javaType="com.XYJ.pojo.Areanew">
            <result column="whole_name" property="wholeName"></result>
            <result column="lon1" property="lon"></result>
            <result column="lat1" property="lat"></result>
            <result column="cc" property="cityCode"></result>
            <result column="zip" property="zipCode"></result>
        </association>
        <association property="admissionpolicys" javaType="com.XYJ.pojo.Admissionpolicy">
            <id column="admissionpolicyid" property="admissionpolicyid"></id>
            <result column="admissionpolicys" property="admissionpolicy"></result>
        </association>
        <association property="organizations" javaType="com.XYJ.pojo.Organization">
            <result column="oname" property="oname"></result>
            <result column="name" property="name"></result>
            <result column="phone" property="phone"></result>
        </association>
        <association property="aapplications" javaType="com.XYJ.pojo.Aapplication">
            <id column="applicationid" property="applicationid"></id>
            <result column="atime" property="atime"></result>
        </association>
        <association property="activestatus" javaType="com.XYJ.pojo.Activestatus">
            <result column="status" property="status"></result>
        </association>
        <association property="signrecords" javaType="com.XYJ.pojo.Signrecord">
            <id column="recordid" property="recordid"></id>
            <result column="signintime" property="signintime"></result>
        </association>
    </resultMap>
    <select id="selectByAcstyleidjoin" resultMap="rs1">
        select *,acstyle.acstyle as aa,admissionpolicy.admissionpolicy as admissionpolicys   from activity , acstyle,admissionpolicy where activity.acstyle = acstyle.acstyleid and activity.admissionpolicy = admissionpolicy.admissionpolicyid  and activity.activityid = #{activityid}
    </select>
    <select id="selectActivityV" resultMap="rs1">
        select  *,acstyle.acstyle as aa,areanew.whole_name,organization.oname from activity, acstyle,areanew,organization
        <where>
            activity.organizationid = organization.organizationid and activity.acstyle = acstyle.acstyleid and activity.district = areanew.area_code and areanew.level = 3
            <if test="acstyle != 0">
                and activity.acstyle = #{acstyle}
            </if>
            <if test="activestatusid != 0">
                and activity.activestatusid = #{activestatusid}
            </if>
            <if test="activestatusid == 0">
                and activity.activestatusid in (1,2,3,4)
            </if>
            <if test="starttime != null and starttime != ''">
                and starttime  <![CDATA[>]]>= #{starttime}
            </if>
            <if test="endtime != null and endtime != ''">
                and endtime  <![CDATA[<]]>= #{endtime}
            </if>
            <if test="activityid != null and activityid != '' ">
                and activityid like
                concat('%',#{activityid},'%');
            </if>
            <if test="title != null and title != '' ">
                and title like
                concat('%',#{title},'%')
            </if>
        </where>
    </select>
    <select id="selectActivityVCount" resultType="java.lang.Integer">
        select count(*) from activity, acstyle,areanew,organization
        <where>
            activity.organizationid = organization.organizationid and activity.acstyle = acstyle.acstyleid and activity.district = areanew.area_code and areanew.level = 3
            <if test="acstyle != 0">
                and activity.acstyle = #{acstyle}
            </if>
            <if test="activestatusid != 0">
                and activity.activestatusid = #{activestatusid}
            </if>
            <if test="activestatusid == 0">
                and activity.activestatusid in (1,2,3,4)
            </if>
            <if test="starttime != null and starttime != ''">
                and starttime  <![CDATA[>]]>= #{starttime}
            </if>
            <if test="endtime != null and endtime != ''">
                and endtime  <![CDATA[<]]>= #{endtime}
            </if>
            <if test="activityid != null and activityid != '' ">
                and activityid like
                concat('%',#{activityid},'%');
            </if>
            <if test="title != null and title != '' ">
                and title like
                concat('%',#{title},'%')
            </if>
        </where>
    </select>

    <select id="selectActivityVFY" resultMap="rs1">
        select  *,acstyle.acstyle as aa,areanew.whole_name,organization.oname from activity, acstyle,areanew,organization
        <where>
            activity.organizationid = organization.organizationid and activity.acstyle = acstyle.acstyleid and activity.district = areanew.area_code and areanew.level = 3
            <if test="activity.acstyle != 0">
                and activity.acstyle = #{activity.acstyle}
            </if>
            <if test="activity.activestatusid != 0">
                and activity.activestatusid = #{activity.activestatusid}
            </if>
            <if test="activity.activestatusid == 0">
                and activity.activestatusid in (1,2,3,4)
            </if>
            <if test="activity.starttime != null and activity.starttime != ''">
                and starttime  <![CDATA[>]]>= #{activity.starttime}
            </if>
            <if test="activity.endtime != null and activity.endtime != ''">
                and endtime  <![CDATA[<]]>= #{activity.endtime}
            </if>
            <if test="activity.activityid != null and activity.activityid != '' ">
                and activityid like
                concat('%',#{activity.activityid},'%');
            </if>
            <if test="activity.title != null and activity.title != '' ">
                and title like
                concat('%',#{activity.title},'%')
            </if>
        </where>
        order by activity.starttime limit #{begin},#{size};
    </select>


    <select id="selectActivityByVIDFY" resultMap="rs1">
        select *,areanew.whole_name,organization.oname,activestatus.`status`,(select count(*) from signcode where activity.activityid = signcode.activityid ) as lon1 ,(select signinid from signcode where activity.activityid = signcode.activityid ) as lat1,(select count(*) from signrecord where aapplication.applicationid = signrecord.applicationid ) as cc ,(select count(*) from aleave where aapplication.applicationid = aleave.applicationid and statusid = 1 ) as zip,(select signintime from signrecord where signrecord.applicationid = aapplication.applicationid) as signintime  from activity, organization,areanew,aapplication,activestatus
        where activity.activityid = aapplication.activityid AND
            activity.organizationid = organization.organizationid AND
            activity.activestatusid = activestatus.activestatusid
       <if test="activity.activestatusid == 1">
           and activity.activestatusid in (1,2)
       </if>
        <if test="activity.activestatusid == 3">
            and activity.activestatusid = 3
        </if>
        <if test="activity.activestatusid == 4">
            and activity.activestatusid = 4
        </if>
          and activity.district = areanew.area_code and areanew.`level` = 3 and aapplication.applicationstatusid = #{activity.applicationstatusid}
          and aapplication.volunteerid = #{activity.volunteerid}
        order by activity.starttime limit #{begin},#{size};
    </select>

    <select id="selectActivityByVIDCount" resultType="java.lang.Integer">
        select count(*) from activity, organization,areanew,aapplication,activestatus
        where activity.activityid = aapplication.activityid AND
        activity.organizationid = organization.organizationid AND
        activity.activestatusid = activestatus.activestatusid
        <if test="activestatusid == 1">
            and activity.activestatusid in (1,2)
        </if>
        <if test="activestatusid == 3">
            and activity.activestatusid = 3
        </if>
        <if test="activestatusid == 4">
            and activity.activestatusid = 4
        </if>
        and activity.district = areanew.area_code and areanew.`level` = 3 and aapplication.applicationstatusid = #{applicationstatusid}
        and aapplication.volunteerid = #{volunteerid}
    </select>

    <select id="selectActivityAID" resultMap="rs1">
        select *,ac.acstyle as aa from activity a
            LEFT JOIN organization o on a.organizationid = o.organizationid
            left join acstyle ac on a.acstyle = ac.acstyleid
            left join areanew ar on a.district = ar.area_code and ar.`level` = 3
        where a.activityid = #{activityid}
    </select>


</mapper>
